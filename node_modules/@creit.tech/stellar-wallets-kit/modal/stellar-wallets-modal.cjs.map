{"version":3,"file":"stellar-wallets-modal.cjs","sources":["../../src/modal/stellar-wallets-modal.ts"],"sourcesContent":["import { LitElement, html, css } from 'lit';\nimport { styleMap } from 'lit/directives/style-map.js';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport { ISupportedWallet } from '../types';\nimport {\n  backdropStyles,\n  modalWalletsSection,\n  modalDialogBodyStyles,\n  modalDialogStyles,\n  modalHelpSection,\n  modalAnimations,\n} from './styles';\n\n@customElement('stellar-wallets-modal')\nexport class StellarWalletsModal extends LitElement {\n  static override styles = [\n    css`\n      :host * {\n        box-sizing: border-box;\n      }\n\n      .mb-0 {\n        margin-bottom: 0 !important;\n      }\n    `,\n    modalDialogStyles,\n    modalDialogBodyStyles,\n    modalHelpSection,\n    backdropStyles,\n    modalAnimations,\n    modalWalletsSection,\n  ];\n\n  @property({ type: Boolean, reflect: true })\n  showModal: boolean = false;\n\n  @property({ type: Boolean, reflect: true })\n  closingModal: boolean = false;\n\n  @property({ type: String, reflect: true })\n  modalTitle: string = 'Connect a Wallet';\n\n  @property({ type: String, reflect: true })\n  notAvailableText: string = 'Not available';\n\n  @property({\n    type: Array,\n    reflect: true,\n    converter: { fromAttribute: (v: string) => JSON.parse(v) },\n  })\n  allowedWallets: ISupportedWallet[] = [];\n\n  @property({\n    converter: {\n      fromAttribute: (v: string) => v && { ...JSON.parse(v), zIndex: 990 },\n    },\n  })\n  modalDialogStyles = { zIndex: 990 };\n\n  override connectedCallback() {\n    super.connectedCallback();\n  }\n\n  async closeModal(): Promise<void> {\n    this.closingModal = true;\n\n    await new Promise(r => setTimeout(r, 300));\n\n    this.showModal = false;\n\n    this.dispatchEvent(\n      new CustomEvent('modal-closed', {\n        detail: new Error('Modal closed'),\n        bubbles: true,\n        composed: true,\n      })\n    );\n  }\n\n  async pickWalletOption(option: ISupportedWallet): Promise<void> {\n    if (!option.isAvailable) {\n      window.open(option.url, '_blank');\n      return;\n    }\n\n    this.closingModal = true;\n\n    await new Promise(r => setTimeout(r, 300));\n\n    try {\n      const record: string | null = window.localStorage.getItem('@StellarWalletsKit/usedWalletsIds');\n      let usedWalletsIds: Array<ISupportedWallet['id']> = record ? JSON.parse(record) : [];\n      usedWalletsIds = [option.id, ...usedWalletsIds.filter((id: string): boolean => id !== option.id)];\n      window.localStorage.setItem('@StellarWalletsKit/usedWalletsIds', JSON.stringify(usedWalletsIds));\n    } catch (e) {\n      console.error(e);\n    }\n\n    this.dispatchEvent(\n      new CustomEvent('wallet-selected', {\n        detail: option,\n        bubbles: true,\n        composed: true,\n      })\n    );\n  }\n\n  /**\n   * This function gets the list of the wallets following the logic from this task https://github.com/Creit-Tech/Stellar-Wallets-Kit/issues/28\n   * It follows this order:\n   * 1- Wallet last used by wallet selector\n   * 2- If not wallet last use, wallets detected in the browser\n   * 3- Wallet ordering as defined by the developer\n   *\n   */\n  private getSortedList(): ISupportedWallet[] {\n    const sortedWallets: { available: ISupportedWallet[]; unavailable: ISupportedWallet[] } =\n      this.allowedWallets.reduce(\n        (all: { available: ISupportedWallet[]; unavailable: ISupportedWallet[] }, current: ISupportedWallet) => {\n          return {\n            available: current.isAvailable ? [...all.available, current] : all.available,\n            unavailable: !current.isAvailable ? [...all.unavailable, current] : all.unavailable,\n          };\n        },\n        { available: [], unavailable: [] }\n      );\n\n    let usedWalletsIds: Array<ISupportedWallet['id']>;\n    try {\n      const record: string | null = window.localStorage.getItem('@StellarWalletsKit/usedWalletsIds');\n      usedWalletsIds = record ? JSON.parse(record) : [];\n    } catch (e) {\n      console.error(e);\n      usedWalletsIds = [];\n    }\n\n    if (usedWalletsIds.length === 0) {\n      return [...sortedWallets.available, ...sortedWallets.unavailable];\n    }\n\n    const usedWallets: ISupportedWallet[] = [];\n    const nonUsedWallets: ISupportedWallet[] = [];\n    for (const availableWallet of sortedWallets.available) {\n      if (usedWalletsIds.find((id: string): boolean => id === availableWallet.id)) {\n        usedWallets.push(availableWallet);\n      } else {\n        nonUsedWallets.push(availableWallet);\n      }\n    }\n\n    return [\n      ...usedWallets.sort((a: ISupportedWallet, b: ISupportedWallet) => {\n        return usedWalletsIds.indexOf(a.id) - usedWalletsIds.indexOf(b.id);\n      }),\n      ...nonUsedWallets,\n      ...sortedWallets.unavailable,\n    ];\n  }\n\n  override render() {\n    const helpSection = html`\n      <section class=\"help-container\">\n        <header class=\"help-header\">\n          <h2 class=\"help-header__modal-title dialog-text-solid\">Learn more</h2>\n        </header>\n\n        <div class=\"help__whats_a_wallet\">\n          <h2 class=\"dialog-text-solid help__title\">What is a wallet?</h2>\n          <p class=\"dialog-text help__text\">\n            Wallets are used to send, receive, and store the keys you use to sign blockchain transactions.\n          </p>\n        </div>\n\n        <div class=\"help__whats_stellar\">\n          <h2 class=\"dialog-text-solid help__title\">What is Stellar?</h2>\n          <p class=\"dialog-text help__text\">\n            Stellar is a decentralized, public blockchain that gives developers the tools to create experiences that are\n            more like cash than crypto\n          </p>\n        </div>\n      </section>\n    `;\n\n    const walletsSection = html`\n      <section class=\"wallets-container\">\n        <header class=\"wallets-header\">\n          <h2 class=\"wallets-header__modal-title dialog-text-solid\">${this.modalTitle}</h2>\n\n          <button @click=${() => this.closeModal()} class=\"wallets-header__button\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"#000000\" height=\"20px\" width=\"20px\" viewBox=\"0 0 490 490\">\n              <polygon\n                points=\"456.851,0 245,212.564 33.149,0 0.708,32.337 212.669,245.004 0.708,457.678 33.149,490 245,277.443 456.851,490   489.292,457.678 277.331,245.004 489.292,32.337 \" />\n            </svg>\n          </button>\n        </header>\n\n        <ul class=\"wallets-body\">\n          ${this.getSortedList().map(\n            (item: ISupportedWallet, i: number) =>\n              html`\n                <li\n                  @click=${() => this.pickWalletOption(item)}\n                  class=\" wallets-body__item ${!item.isAvailable ? 'not-available' : ''} ${i ===\n                  this.allowedWallets.length - 1\n                    ? 'mb-0'\n                    : ''}\">\n                  <img src=${item.icon} alt=${item.name} />\n                  <span class=\"dialog-text-solid\">${item.name}</span>\n                  ${!item.isAvailable ? html`<small class=\"not-available\">${this.notAvailableText}</small>` : ''}\n                </li>\n              `\n          )}\n        </ul>\n      </section>\n    `;\n\n    return html`\n      <dialog\n        style=${styleMap(this.modalDialogStyles)}\n        class=\"dialog-modal ${this.closingModal ? 'closing' : ''}\"\n        .open=${this.showModal}>\n        <section class=\"dialog-modal-body\">\n          <div class=\"dialog-modal-body__help\">${helpSection}</div>\n          <div class=\"dialog-modal-body__wallets\">${walletsSection}</div>\n        </section>\n      </dialog>\n\n      <div\n        style=\"position: fixed; z-index: 950\"\n        class=\"backdrop ${this.closingModal ? 'closing' : ''}\"\n        @click=${() => this.closeModal()}></div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'stellar-wallets-modal': StellarWalletsModal;\n  }\n}\n"],"names":["StellarWalletsModal","LitElement","html","styleMap","css","modalDialogStyles","modalDialogBodyStyles","modalHelpSection","backdropStyles","modalAnimations","modalWalletsSection","property","customElement"],"mappings":"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"}